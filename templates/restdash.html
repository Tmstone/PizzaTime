<!DOCTYPE html>
<html lang="en" dir="ltr">
     <head>
          <meta charset="utf-8">
          <meta name="Pizza TIme" content="An intuitive food ordering app.">
          <title>Black Belt Pizza | Store Dashboard</title>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
          <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
          <!-- <script src="{{ url_for('static', filename='script.js') }}"></script> -->
          <script src="{{ url_for('static', filename='timer.js')}}"></script>
          <script>
               $(function(){
                    //connect to the socket server.
                    var socket = io.connect('http://' + document.domain + ':' + location.port + '/restdash');
                    //receive details from server
                    socket.on('neworder', function(msg) {
                         console.log("Received order" + msg);
                         $("#current_orders").append(msg);
                    });
               })
          </script>
     </head>
     <body>
          <div class="container">
               <!-- Restaurant (Kitchen) Dashboard page for Pizza Time  -->
               <div class="header">
                    <div id="aNav"></div>

                    <h1 class="h5">STORE DASHBOARD</h1>
               </div>
               <div >
                    <h1 class="h5" id="order_title">CURRENT ORDERS</h1>
                    <ul class="list-unstyled" id="current_orders">
                    {% for order in orders: %}
                         <li class="section my-3 customer_order" order_id="{{order.id}}">
                         <p class="order_timer" ordered_at="{{order.updated_at}} GMT"></p>
                         {{order.id}}: {{order.order_type.name}} <br>
                              <ol>
                                   {% for pizza in order.pizzas %}
                                   <li>Qty {{pizza.qty}}, Size {{pizza.size.name}}, {{pizza.style.name}} crust:
                                        {% for topping in pizza.toppings %}
                                             {{topping.info.name}}
                                        {% endfor %}
                                   </li>
                                   <br>
                                   {{order.customer.name}} ({{order.customer.phone_number}}), {{order.customer.addresses[0].street_address}}, {{order.customer.addresses[0].city}} {{order.customer.addresses[0].state.name}}
                                   {% endfor %}
                              </ol>
                         </li>
                         <!-- Put a button here. It should update a the display using a script.-->
                    {% endfor %}
                    </ul>
               </div>
          </div>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
     </body>
     <script>
               var order_count=$(".order_timer").length;
               var t_d=[];
               $("#order_title").text("CURRENT ORDERS: "+order_count);
               $(".order_timer").each(function(i){
                    t_d[i]=new IntervalTimer;
                    t_d[i].start_time=Date.parse($(this).attr("ordered_at"));
                    console.log(t_d[i].start_time);
                    //$(this).text(t_d[i]);
                    var timer_display=this;
                    t_d[i].on_event=function(){
                         //$("#order_title").text(this.time())
                         //$(timer_display).text(this.time())
                         $(timer_display).text(this.time_string())
                    }
                    t_d[i].start();
               });

     </script>
</html>
